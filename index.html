<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»¼åˆé‡‘èè®¡ç®—å™¨</title>
    <style>
        /* å…¨å±€æ ·å¼ - ç®€æ´ç°ä»£é£æ ¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* å·¦ä¾§å¯¼èˆª - ç»ç’ƒæ‹Ÿæ€æ•ˆæœ */
        .sidebar {
            width: 250px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            border-right: 1px solid rgba(255,255,255,0.5);
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #171360;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-title {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .nav-item {
            display: block;
            padding: 10px 15px;
            color: #444;
            text-decoration: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 5px;
            background: rgba(255,255,255,0.5);
        }

        .nav-item:hover {
            background: rgba(26, 109, 255, 0.1);
            color: #1a6dff;
        }

        .nav-item.active {
            background: rgba(26, 109, 255, 0.15);
            color: #1a6dff;
            font-weight: 500;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .module-content {
            display: none;
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.5);
        }

        .module-content.active {
            display: block;
        }

        .module-header {
            font-size: 28px;
            margin-bottom: 10px;
            color: #1a6dff;
        }

        .module-desc {
            color: #555;
            margin-bottom: 30px;
        }

        /* è¡¨å•æ ·å¼ */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #444;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.7);
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #1a6dff;
            box-shadow: 0 0 0 3px rgba(26, 109, 255, 0.1);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn-calculate {
            background: linear-gradient(135deg, #1a6dff, #0d5bd9);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin: 20px 0;
            box-shadow: 0 4px 10px rgba(26, 109, 255, 0.3);
        }

        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(26, 109, 255, 0.4);
        }

        /* ç»“æœå±•ç¤º */
        .results-section {
            margin-top: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
            border-radius: 12px;
            display: none;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .results-section.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .result-item {
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-label {
            font-size: 14px;
            color: #555;
        }

        .result-value {
            font-size: 24px;
            font-weight: bold;
            color: #1a6dff;
            margin-top: 5px;
        }

        .result-formula {
            margin-top: 10px;
            padding: 10px;
            background: rgba(26, 109, 255, 0.05);
            border-radius: 5px;
            font-size: 14px;
            color: #555;
            font-family: 'Courier New', monospace;
            border-left: 3px solid #1a6dff;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 15px;
            }

            .sidebar.hidden {
                display: none;
            }

            .main-content {
                padding: 15px;
            }

            .input-row {
                grid-template-columns: 1fr;
            }

            .mobile-menu-toggle {
                display: block;
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 1000;
                background: rgba(26, 109, 255, 0.9);
                color: white;
                border: none;
                padding: 10px;
                border-radius: 8px;
                cursor: pointer;
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            }
        }

        @media (min-width: 769px) {
            .mobile-menu-toggle {
                display: none;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å†å²è®°å½• */
        .history-item {
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .history-date {
            color: #1a6dff;
            font-size: 12px;
        }

        /* å¯¼å‡ºæŒ‰é’® */
        .export-buttons {
            margin-top: 20px;
        }

        .btn-export {
            background: linear-gradient(135deg, #00c853, #009624);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,200,83,0.2);
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,200,83,0.3);
        }

        /* æç¤ºä¿¡æ¯ */
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            cursor: help;
            color: #1a6dff;
            font-weight: bold;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            background: rgba(26, 109, 255, 0.9);
            color: white;
            border-radius: 5px;
            white-space: nowrap;
            font-size: 12px;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <button class="mobile-menu-toggle" onclick="toggleSidebar()">â˜° èœå•</button>
    
    <div class="container">
        <!-- å·¦ä¾§å¯¼èˆª -->
        <div class="sidebar" id="sidebar">
            <div class="logo">é‡‘èä¸“ç”¨è®¡ç®—å™¨</div>
            
            <div class="nav-section">
                <div class="nav-title">åŸºç¡€è®¡ç®—</div>
                <a href="#" class="nav-item active" onclick="showModule('compound')">å¤åˆ©è®¡ç®—</a>
                <a href="#" class="nav-item" onclick="showModule('loan')">è´·æ¬¾è®¡ç®—</a>
                <a href="#" class="nav-item" onclick="showModule('bond')">å€ºåˆ¸å®šä»·</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">æŠ•èµ„åˆ†æ</div>
                <a href="#" class="nav-item" onclick="showModule('portfolio')">æŠ•èµ„ç»„åˆ</a>
                <a href="#" class="nav-item" onclick="showModule('capm')">CAPMæ¨¡å‹</a>
                <a href="#" class="nav-item" onclick="showModule('ddm')">è‚¡ç¥¨DDM</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">æ—¶é—´ä»·å€¼</div>
                <a href="#" class="nav-item" onclick="showModule('npv')">NPV/IRR</a>
                <a href="#" class="nav-item" onclick="showModule('annuity')">å¹´é‡‘è®¡ç®—</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">é£é™©ç®¡ç†</div>
                <a href="#" class="nav-item" onclick="showModule('volatility')">æ³¢åŠ¨ç‡</a>
                <a href="#" class="nav-item" onclick="showModule('option')">æœŸæƒå¸Œè…Šå­—æ¯</a>
            </div>
            <div class="nav-section">
            <div class="nav-title">é«˜çº§æ¨¡å‹</div>
            <a href="#" class="nav-item" onclick="showModule('blackscholes')">Black-Scholes</a>
            <a href="#" class="nav-item" onclick="showModule('var')">VaRé£é™©å€¼</a>
            <a href="#" class="nav-item" onclick="showModule('sharpe')">å¤æ™®æ¯”ç‡</a>
            <a href="#" class="nav-item" onclick="showModule('wacc')">WACCæˆæœ¬</a>
            </div>

            <div class="nav-section">
                <div class="nav-title">å…³äº</div>
                <a href="#" class="nav-item" onclick="showModule('team')">å¼€å‘å›¢é˜Ÿ</a>
            </div>
                    <div class="nav-section">
                <div class="nav-title">å†å²è®°å½•</div>
                <div id="historyList"></div>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- å¤åˆ©è®¡ç®—æ¨¡å— -->
            <div class="module-content active" id="compound">
                <h2 class="module-header">å¤åˆ©è®¡ç®—</h2>
                <p class="module-desc">è®¡ç®—å¤åˆ©ç»ˆå€¼ã€ç°å€¼ï¼Œæ”¯æŒå®šæœŸå®šæŠ•</p>
                
                <div class="input-group">
                    <label>ç°å€¼ (PV) <span class="tooltip" data-tooltip="åˆå§‹æŠ•èµ„é‡‘é¢">?</span></label>
                    <input type="number" id="compoundPV" value="" step="0.01">
                </div>
                
                <div class="input-row">
                    <div class="input-group">
                        <label>å¹´åˆ©ç‡ (%) <span class="tooltip" data-tooltip="å¹´åŒ–æ”¶ç›Šç‡">?</span></label>
                        <input type="number" id="compoundRate" value="" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>æœŸé™ (å¹´) <span class="tooltip" data-tooltip="æŠ•èµ„å¹´é™">?</span></label>
                        <input type="number" id="compoundYears" value="" step="0.1">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>å®šæœŸæŠ•å…¥ (PMT) <span class="tooltip" data-tooltip="æ¯æœŸè¿½åŠ æŠ•èµ„ï¼Œ0è¡¨ç¤ºä¸€æ¬¡æ€§æŠ•å…¥">?</span></label>
                    <input type="number" id="compoundPMT" value="" step="0.01">
                </div>
                
                <div class="input-group">
                    <label>æŠ•å…¥é¢‘ç‡</label>
                    <select id="compoundFreq">
                        <option value="12">æ¯æœˆ</option>
                        <option value="4">æ¯å­£</option>
                        <option value="1">æ¯å¹´</option>
                    </select>
                </div>
                
                <button class="btn-calculate" onclick="calculateCompound()">è®¡ç®—å¤åˆ©</button>
                
                <div class="results-section" id="compoundResults"></div>
            </div>
            
            <!-- è´·æ¬¾è®¡ç®—æ¨¡å— -->
            <div class="module-content" id="loan">
                <h2 class="module-header">è´·æ¬¾è®¡ç®—å™¨</h2>
                <p class="module-desc">æ”¯æŒç­‰é¢æœ¬æ¯å’Œç­‰é¢æœ¬é‡‘ä¸¤ç§è¿˜æ¬¾æ–¹å¼</p>
                
                <div class="input-group">
                    <label>è´·æ¬¾æ€»é¢ (å…ƒ)</label>
                    <input type="number" id="loanAmount" value="" step="0.01">
                </div>
                
                <div class="input-row">
                    <div class="input-group">
                        <label>å¹´åˆ©ç‡ (%)</label>
                        <input type="number" id="loanRate" value="" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>è´·æ¬¾æœŸé™ (å¹´)</label>
                        <input type="number" id="loanYears" value="" step="1">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>è¿˜æ¬¾æ–¹å¼</label>
                    <select id="loanType">
                        <option value="equal-payment">ç­‰é¢æœ¬æ¯</option>
                        <option value="equal-principal">ç­‰é¢æœ¬é‡‘</option>
                    </select>
                </div>
                
                <button class="btn-calculate" onclick="calculateLoan()">è®¡ç®—è¿˜æ¬¾è®¡åˆ’</button>
                
                <div class="results-section" id="loanResults"></div>
            </div>
            
            <!-- å€ºåˆ¸å®šä»·æ¨¡å— -->
            <div class="module-content" id="bond">
                <h2 class="module-header">å€ºåˆ¸å®šä»·ä¸æ”¶ç›Šç‡</h2>
                <p class="module-desc">è®¡ç®—å€ºåˆ¸ä»·æ ¼å’Œåˆ°æœŸæ”¶ç›Šç‡(YTM)</p>
                
                <div class="input-group">
                    <label>é¢å€¼ (å…ƒ) <span class="tooltip" data-tooltip="å€ºåˆ¸åˆ°æœŸå¿è¿˜çš„æœ¬é‡‘">?</span></label>
                    <input type="number" id="bondFaceValue" value="" step="0.01">
                </div>
                
                <div class="input-row">
                    <div class="input-group">
                        <label>ç¥¨é¢åˆ©ç‡ (%)</label>
                        <input type="number" id="bondCouponRate" value="" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>å‰©ä½™æœŸé™ (å¹´)</label>
                        <input type="number" id="bondYears" value="" step="0.1">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>å¸‚åœºæ”¶ç›Šç‡ (%) <span class="tooltip" data-tooltip="ç”¨äºå®šä»·çš„æŠ˜ç°ç‡">?</span></label>
                    <input type="number" id="bondYield" value="" step="0.01">
                </div>
                
                <button class="btn-calculate" onclick="calculateBond()">è®¡ç®—å€ºåˆ¸ä»·æ ¼</button>
                
                <div class="results-section" id="bondResults"></div>
            </div>
            
            <!-- æŠ•èµ„ç»„åˆæ¨¡å— -->
            <div class="module-content" id="portfolio">
                <h2 class="module-header">æŠ•èµ„ç»„åˆåˆ†æ</h2>
                <p class="module-desc">è®¡ç®—ç»„åˆé¢„æœŸæ”¶ç›Šå’Œé£é™©ï¼ˆæ ‡å‡†å·®ï¼‰</p>
                
                <div class="input-group">
                    <label>èµ„äº§1æƒé‡ (%) <span class="tooltip" data-tooltip="è¾“å…¥æƒé‡ç™¾åˆ†æ¯”">?</span></label>
                    <input type="number" id="weight1" value="" step="0.1">
                </div>
                <div class="input-group">
                    <label>èµ„äº§1é¢„æœŸæ”¶ç›Š (%) <span class="tooltip" data-tooltip="å¹´åŒ–é¢„æœŸæ”¶ç›Šç‡">?</span></label>
                    <input type="number" id="return1" value="" step="0.01">
                </div>
                
                <div class="input-group">
                    <label>èµ„äº§2æƒé‡ (%) <span class="tooltip" data-tooltip="è‡ªåŠ¨è®¡ç®—å‰©ä½™æƒé‡">?</span></label>
                    <input type="number" id="weight2" value="" step="0.1">
                </div>
                <div class="input-group">
                    <label>èµ„äº§2é¢„æœŸæ”¶ç›Š (%) <span class="tooltip" data-tooltip="å¹´åŒ–é¢„æœŸæ”¶ç›Šç‡">?</span></label>
                    <input type="number" id="return2" value="" step="0.01">
                </div>
                
                <div class="input-group">
                    <label>ç›¸å…³ç³»æ•° <span class="tooltip" data-tooltip="-1åˆ°1ä¹‹é—´ï¼Œ0è¡¨ç¤ºä¸ç›¸å…³">?</span></label>
                    <input type="number" id="correlation" value="" step="0.01" min="-1" max="1">
                </div>
                
                <button class="btn-calculate" onclick="calculatePortfolio()">è®¡ç®—ç»„åˆæŒ‡æ ‡</button>
                
                <div class="results-section" id="portfolioResults"></div>
            </div>
            
            <!-- CAPMæ¨¡å— -->
            <div class="module-content" id="capm">
                <h2 class="module-header">CAPMæ¨¡å‹</h2>
                <p class="module-desc">èµ„æœ¬èµ„äº§å®šä»·æ¨¡å‹è®¡ç®—é¢„æœŸæ”¶ç›Šç‡</p>
                
                <div class="input-group">
                    <label>æ— é£é™©åˆ©ç‡ (%) <span class="tooltip" data-tooltip="é€šå¸¸å–å›½å€ºæ”¶ç›Šç‡">?</span></label>
                    <input type="number" id="riskFreeRate" value="" step="0.01">
                </div>
                
                <div class="input-group">
                    <label>å¸‚åœºé£é™©æº¢ä»· (%) <span class="tooltip" data-tooltip="å¸‚åœºé¢„æœŸæ”¶ç›Š-æ— é£é™©åˆ©ç‡">?</span></label>
                    <input type="number" id="marketRiskPremium" value="" step="0.01">
                </div>
                
                <div class="input-group">
                    <label>Betaç³»æ•° <span class="tooltip" data-tooltip="ç³»ç»Ÿé£é™©ç³»æ•°ï¼Œ>1é£é™©é«˜äºå¸‚åœº">?</span></label>
                    <input type="number" id="beta" value="" step="0.01">
                </div>
                
                <button class="btn-calculate" onclick="calculateCapm()">è®¡ç®—é¢„æœŸæ”¶ç›Š</button>
                
                <div class="results-section" id="capmResults"></div>
            </div>
            
            <!-- DDMæ¨¡å— -->
            <div class="module-content" id="ddm">
                <h2 class="module-header">è‚¡ç¥¨DDMä¼°å€¼</h2>
                <p class="module-desc">è‚¡åˆ©è´´ç°æ¨¡å‹è®¡ç®—è‚¡ç¥¨å†…åœ¨ä»·å€¼</p>
                
                <div class="input-group">
                    <label>æœ€è¿‘è‚¡åˆ© (å…ƒ) <span class="tooltip" data-tooltip="æœ€è¿‘ä¸€æœŸæ”¯ä»˜çš„è‚¡åˆ©">?</span></label>
                    <input type="number" id="recentDividend" value="" step="0.01">
                </div>
                
                <div class="input-group">
                    <label>è‚¡åˆ©å¢é•¿ç‡ (%) <span class="tooltip" data-tooltip="æ°¸ç»­å¢é•¿ç‡gï¼Œåº”å°äºæŠ˜ç°ç‡">?</span></label>
                    <input type="number" id="growthRate" value="" step="0.01">
                </div>
                
                <div class="input-group">
                    <label>è¦æ±‚å›æŠ¥ç‡ (%) <span class="tooltip" data-tooltip="æŠ•èµ„è€…çš„é¢„æœŸå›æŠ¥ç‡">?</span></label>
                    <input type="number" id="requiredReturn" value="" step="0.01">
                </div>
                
                <button class="btn-calculate" onclick="calculateDDM()">è®¡ç®—è‚¡ç¥¨ä»·å€¼</button>
                
                <div class="results-section" id="ddmResults"></div>
            </div>
            
            <!-- NPV/IRRæ¨¡å— -->
            <div class="module-content" id="npv">
                <h2 class="module-header">NPVä¸IRRè®¡ç®—</h2>
                <p class="module-desc">å‡€ç°å€¼å’Œå†…éƒ¨æ”¶ç›Šç‡åˆ†æ</p>
                
                <div class="input-group">
                    <label>åˆå§‹æŠ•èµ„ (å…ƒ) <span class="tooltip" data-tooltip="æœŸåˆç°é‡‘æµï¼ˆè´Ÿå€¼ï¼‰">?</span></label>
                    <input type="number" id="initialInvestment" value="value" step="0.01">
                </div>
                
                <div class="input-group">
                    <label>ç°é‡‘æµåºåˆ— (å…ƒï¼Œé€—å·åˆ†éš”) <span class="tooltip" data-tooltip="ä¾‹å¦‚: 20000,25000,30000">?</span></label>
                    <input type="text" id="cashFlows" value="">
                </div>
                
                <div class="input-group">
                    <label>æŠ˜ç°ç‡ (%) <span class="tooltip" data-tooltip="èµ„æœ¬æˆæœ¬æˆ–è¦æ±‚å›æŠ¥ç‡">?</span></label>
                    <input type="number" id="discountRate" value="" step="0.01">
                </div>
                
                <button class="btn-calculate" onclick="calculateNPV()">è®¡ç®—NPV/IRR</button>
                
                <div class="results-section" id="npvResults"></div>
            </div>
            
            <!-- å¹´é‡‘æ¨¡å— -->
            <div class="module-content" id="annuity">
                <h2 class="module-header">å¹´é‡‘è®¡ç®—</h2>
                <p class="module-desc">æ™®é€šå¹´é‡‘ã€é¢„ä»˜å¹´é‡‘å’Œæ°¸ç»­å¹´é‡‘</p>
                
                <div class="input-group">
                    <label>æ¯æœŸæ”¯ä»˜ (å…ƒ) <span class="tooltip" data-tooltip="æ¯æœŸå›ºå®šæ”¯ä»˜é‡‘é¢">?</span></label>
                    <input type="number" id="annuityPayment" value="" step="0.01">
                </div>
                
                <div class="input-row">
                    <div class="input-group">
                        <label>åˆ©ç‡ (%)</label>
                        <input type="number" id="annuityRate" value="" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>æœŸæ•°</label>
                        <input type="number" id="annuityPeriods" value="" step="1">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>å¹´é‡‘ç±»å‹</label>
                    <select id="annuityType">
                        <option value="ordinary">æ™®é€šå¹´é‡‘ï¼ˆæœŸæœ«æ”¯ä»˜ï¼‰</option>
                        <option value="due">é¢„ä»˜å¹´é‡‘ï¼ˆæœŸåˆæ”¯ä»˜ï¼‰</option>
                        <option value="perpetuity">æ°¸ç»­å¹´é‡‘</option>
                    </select>
                </div>
                
                <button class="btn-calculate" onclick="calculateAnnuity()">è®¡ç®—å¹´é‡‘ä»·å€¼</button>
                
                <div class="results-section" id="annuityResults"></div>
            </div>
            
            <!-- æ³¢åŠ¨ç‡æ¨¡å— -->
            <div class="module-content" id="volatility">
                <h2 class="module-header">æ³¢åŠ¨ç‡ä¸æœ€å¤§å›æ’¤</h2>
                <p class="module-desc">è®¡ç®—æ”¶ç›Šåºåˆ—çš„æ³¢åŠ¨ç‡å’Œæœ€å¤§å›æ’¤</p>
                
                <div class="input-group">
                    <label>æ”¶ç›Šç‡åºåˆ— (%ï¼Œé€—å·åˆ†éš”) <span class="tooltip" data-tooltip="ä¾‹å¦‚: 5,8,-3,12,6">?</span></label>
                    <input type="text" id="returnSeries" value="">
                </div>
                
                <button class="btn-calculate" onclick="calculateVolatility()">è®¡ç®—é£é™©æŒ‡æ ‡</button>
                
                <div class="results-section" id="volatilityResults"></div>
            </div>
            
            <!-- æœŸæƒå¸Œè…Šå­—æ¯æ¨¡å— -->
            <div class="module-content" id="option">
                <h2 class="module-header">æœŸæƒå¸Œè…Šå­—æ¯</h2>
                <p class="module-desc">æœŸæƒDeltaå’ŒGammaè¿‘ä¼¼è®¡ç®—</p>
                
                <div class="input-group">
                    <label>æ ‡çš„èµ„äº§ä»·æ ¼</label>
                    <input type="number" id="underlyingPrice" value="" step="0.01">
                </div>
                
                <div class="input-row">
                    <div class="input-group">
                        <label>è¡Œæƒä»·</label>
                        <input type="number" id="strikePrice" value="" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>åˆ°æœŸæ—¶é—´ (å¹´)</label>
                        <input type="number" id="timeToExpiry" value="" step="0.01">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>æ— é£é™©åˆ©ç‡ (%)</label>
                    <input type="number" id="optionRiskFree" value="" step="0.01">
                </div>
                
                <div class="input-group">
                    <label>æ³¢åŠ¨ç‡ (%)</label>
                    <input type="number" id="optionVolatility" value="" step="0.01">
                </div>

                
                <button class="btn-calculate" onclick="calculateOptionGreeks()">è®¡ç®—å¸Œè…Šå­—æ¯</button>
                
                <div class="results-section" id="optionResults"></div>
            </div>
            <!-- Black-Scholeså®Œæ•´å®šä»·æ¨¡å— -->
<div class="module-content" id="blackscholes">
    <h2 class="module-header">Black-ScholesæœŸæƒå®šä»·</h2>
    <p class="module-desc">å®Œæ•´çš„Black-ScholesæœŸæƒå®šä»·æ¨¡å‹</p>
    
    <div class="input-row">
        <div class="input-group">
            <label>æ ‡çš„èµ„äº§ä»·æ ¼ (S)</label>
            <input type="number" id="bsStock" value="" step="0.01">
        </div>
        <div class="input-group">
            <label>è¡Œæƒä»· (K)</label>
            <input type="number" id="bsStrike" value="" step="0.01">
        </div>
    </div>
    
    <div class="input-row">
        <div class="input-group">
            <label>åˆ°æœŸæ—¶é—´ (å¹´)</label>
            <input type="number" id="bsTime" value="" step="0.01">
        </div>
        <div class="input-group">
            <label>æ³¢åŠ¨ç‡ (%)</label>
            <input type="number" id="bsVol" value="" step="0.1">
        </div>
    </div>
    
    <div class="input-row">
        <div class="input-group">
            <label>æ— é£é™©åˆ©ç‡ (%)</label>
            <input type="number" id="bsRate" value="" step="0.01">
        </div>
        <div class="input-group">
            <label>è‚¡æ¯ç‡ (%)</label>
            <input type="number" id="bsDividend" value="" step="0.01">
        </div>
    </div>
    
    <button class="btn-calculate" onclick="calculateBlackScholes()">è®¡ç®—æœŸæƒä»·æ ¼</button>
    
    <div class="results-section" id="bsResults"></div>
</div>

<!-- VaRé£é™©å€¼è®¡ç®—æ¨¡å— -->
<div class="module-content" id="var">
    <h2 class="module-header">VaRé£é™©ä»·å€¼è®¡ç®—</h2>
    <p class="module-desc">è®¡ç®—æŠ•èµ„ç»„åˆçš„åœ¨é™©ä»·å€¼</p>
    
    <div class="input-group">
        <label>æŠ•èµ„ç»„åˆä»·å€¼ (å…ƒ)</label>
        <input type="number" id="varPortfolio" value="" step="1000">
    </div>
    
    <div class="input-row">
        <div class="input-group">
            <label>é¢„æœŸæ”¶ç›Šç‡ (%)</label>
            <input type="number" id="varReturn" value="" step="0.1">
        </div>
        <div class="input-group">
            <label>æ³¢åŠ¨ç‡ (%)</label>
            <input type="number" id="varVolatility" value="" step="0.1">
        </div>
    </div>
    
    <div class="input-row">
        <div class="input-group">
            <label>ç½®ä¿¡æ°´å¹³</label>
            <select id="varConfidence">
                <option value="0.90">90%</option>
                <option value="0.95" selected>95%</option>
                <option value="0.99">99%</option>
            </select>
        </div>
        <div class="input-group">
            <label>æ—¶é—´èŒƒå›´ (å¤©)</label>
            <input type="number" id="varDays" value="1" step="1">
        </div>
    </div>
    
    <button class="btn-calculate" onclick="calculateVaR()">è®¡ç®—VaR</button>
    
    <div class="results-section" id="varResults"></div>
</div>

<!-- å¤æ™®æ¯”ç‡åˆ†ææ¨¡å— -->
<div class="module-content" id="sharpe">
    <h2 class="module-header">å¤æ™®æ¯”ç‡ä¸é£é™©è°ƒæ•´æ”¶ç›Š</h2>
    <p class="module-desc">è¯„ä¼°æŠ•èµ„ç»„åˆçš„é£é™©è°ƒæ•´åè¡¨ç°</p>
    
    <div class="input-group">
        <label>æŠ•èµ„ç»„åˆå¹´åŒ–æ”¶ç›Šç‡ (%)</label>
        <input type="number" id="sharpeReturn" value="" step="0.1">
    </div>
    
    <div class="input-group">
        <label>æ— é£é™©åˆ©ç‡ (%)</label>
        <input type="number" id="sharpeRiskFree" value="" step="0.1">
    </div>
    
    <div class="input-group">
        <label>æŠ•èµ„ç»„åˆæ ‡å‡†å·® (%)</label>
        <input type="number" id="sharpeStdDev" value="" step="0.1">
    </div>
    
    <div class="input-group">
        <label>å¸‚åœºåŸºå‡†æ”¶ç›Šç‡ (%) <span class="tooltip" data-tooltip="ç”¨äºè®¡ç®—Treynorå’ŒJensen's Alpha">?</span></label>
        <input type="number" id="sharpeMarketReturn" value="" step="0.1">
    </div>
    
    <div class="input-group">
        <label>Betaç³»æ•°</label>
        <input type="number" id="sharpeBeta" value="" step="0.01">
    </div>
    
    <button class="btn-calculate" onclick="calculateSharpe()">è®¡ç®—é£é™©æŒ‡æ ‡</button>
    
    <div class="results-section" id="sharpeResults"></div>
</div>

<!-- WACCåŠ æƒå¹³å‡èµ„æœ¬æˆæœ¬æ¨¡å— -->
<div class="module-content" id="wacc">
    <h2 class="module-header">WACCåŠ æƒå¹³å‡èµ„æœ¬æˆæœ¬</h2>
    <p class="module-desc">è®¡ç®—ä¼ä¸šçš„èµ„æœ¬æˆæœ¬</p>
    
    <div class="input-group">
        <label>æƒç›Šå¸‚å€¼ (ä¸‡å…ƒ)</label>
        <input type="number" id="waccEquity" value="" step="100">
    </div>
    
    <div class="input-group">
        <label>å€ºåŠ¡å¸‚å€¼ (ä¸‡å…ƒ)</label>
        <input type="number" id="waccDebt" value="" step="100">
    </div>
    
    <div class="input-row">
        <div class="input-group">
            <label>æƒç›Šæˆæœ¬ (%) <span class="tooltip" data-tooltip="è‚¡ä¸œè¦æ±‚å›æŠ¥ç‡">?</span></label>
            <input type="number" id="waccCostEquity" value="" step="0.1">
        </div>
        <div class="input-group">
            <label>å€ºåŠ¡æˆæœ¬ (%) <span class="tooltip" data-tooltip="ç¨å‰å€ºåŠ¡æˆæœ¬">?</span></label>
            <input type="number" id="waccCostDebt" value="" step="0.1">
        </div>
    </div>
    
    <div class="input-group">
        <label>ä¼ä¸šæ‰€å¾—ç¨ç‡ (%)</label>
        <input type="number" id="waccTaxRate" value="" step="0.1">
    </div>
    
    <button class="btn-calculate" onclick="calculateWACC()">è®¡ç®—WACC</button>
    
    <div class="results-section" id="waccResults"></div>
</div>

<!-- å¼€å‘å›¢é˜Ÿä»‹ç»æ¨¡å— -->
<div class="module-content" id="team">
    <h2 class="module-header">å¼€å‘å›¢é˜Ÿä»‹ç»</h2>
    <p class="module-desc">ä¸“ä¸šçš„é‡‘èç§‘æŠ€å¼€å‘å›¢é˜Ÿ</p>
    
    <div style="margin-top: 30px;">
        <!-- å›¢é˜Ÿæ¦‚è¿° -->
        <div class="result-item" style="background: linear-gradient(135deg, rgba(26, 109, 255, 0.1), rgba(26, 109, 255, 0.05)); border-left: 4px solid #1a6dff;">
            <h3 style="color: #1a6dff; margin-bottom: 10px;">å›¢é˜Ÿç®€ä»‹</h3>
            <p style="color: #555; line-height: 1.8;">
                æˆ‘ä»¬æ˜¯ä¸€æ”¯ä¸“æ³¨äºé‡‘èç§‘æŠ€é¢†åŸŸçš„ä¸“ä¸šå¼€å‘å›¢é˜Ÿï¼Œè‡´åŠ›äºä¸ºç”¨æˆ·æä¾›ç²¾å‡†ã€é«˜æ•ˆçš„é‡‘èè®¡ç®—å·¥å…·ã€‚
                å›¢é˜Ÿæˆå‘˜å‡å…·æœ‰é‡‘èå­¦ã€è®¡ç®—æœºç§‘å­¦èƒŒæ™¯ï¼Œæ‹¥æœ‰ä¸°å¯Œçš„é‡åŒ–æŠ•èµ„å’Œè½¯ä»¶å¼€å‘ç»éªŒã€‚
            </p>
        </div>
        
        <!-- å›¢é˜Ÿæˆå‘˜å¡ç‰‡ -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px;">
            <!-- æˆå‘˜1 -->
            <div class="result-item" style="text-align: center; padding: 25px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold;">
                    ç‹
                </div>
                <h4 style="color: #333; margin-bottom: 5px;">è¥¿ç“œå¤§ç‹</h4>
                <p style="color: #1a6dff; font-size: 14px; margin-bottom: 10px;">ç³»ç»Ÿæ¶æ„å¸ˆ</p>
                <p style="color: #666; font-size: 13px; line-height: 1.6;">
                    å–œæ¬¢ç©æŠ½è±¡ï¼Œçˆ±å¥½debug<br>
                    åå‘æŠ½è±¡ç¨‹åºå‘˜<br>
                    æœ‰é—®é¢˜æ¬¢è¿è”ç³»å“ˆ
                </p>
                <div style="margin-top: 15px; font-size: 12px; color: #999;">
                    æ“…é•¿ï¼šç®—æ³•ã€é£é™©ç®¡ç†
                </div>
            </div>
            
            <!-- æˆå‘˜2 -->
            <div class="result-item" style="text-align: center; padding: 25px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold;">
                    æ
                </div>
                <h4 style="color: #333; margin-bottom: 5px;">ä¸ƒä¸ƒ</h4>
                <p style="color: #1a6dff; font-size: 14px; margin-bottom: 10px;">é‡‘èåˆ†æå¸ˆ</p>
                <p style="color: #666; font-size: 13px; line-height: 1.6;">
                    çˆ±å­¦ä¹ çš„å¥³å­©åŠ ä¸€<br>
                    å–œæ¬¢è‹±è¯­å’Œé‡‘è<br>
                    é‡‘èçš„ä¸€ä½å¤§ä½¬
                </p>
                <div style="margin-top: 15px; font-size: 12px; color: #999;">
                    æ“…é•¿ï¼šé‡‘èç³»ç»Ÿæ¶æ„ã€æ€§èƒ½ä¼˜åŒ–
                </div>
            </div>
            
            <!-- æˆå‘˜3 -->
            <div class="result-item" style="text-align: center; padding: 25px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold;">
                    æ
                </div>
                <h4 style="color: #333; margin-bottom: 5px;">kionone</h4>
                <p style="color: #1a6dff; font-size: 14px; margin-bottom: 10px;">é‡åŒ–åˆ†æå¸ˆ</p>
                <p style="color: #666; font-size: 13px; line-height: 1.6;">
                    å¤§å­¦ç”Ÿä¸€æš<br>
                    ä¸“ä¸šçš„é‡åŒ–å¤§ä½¬<br>
                    å¹³æ—¶æ¯”è¾ƒä½è°ƒ
                </p>
                <div style="margin-top: 15px; font-size: 12px; color: #999;">
                    æ“…é•¿ï¼šæ•°æ®åˆ†æã€æ¨¡å‹æ„å»º
                </div>
            </div>
            
            <!-- æˆå‘˜4 -->
            <div class="result-item" style="text-align: center; padding: 25px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold;">
                    æ
                </div>
                <h4 style="color: #333; margin-bottom: 5px;">è€è€¿é±¼</h4>
                <p style="color: #1a6dff; font-size: 14px; margin-bottom: 10px;">è§†è§‰è®¾è®¡å¸ˆ</p>
                <p style="color: #666; font-size: 13px; line-height: 1.6;">
                    å–œæ¬¢å‰ç«¯è®¾è®¡<br>
                    ä¸“ä¸šçš„UI/UXè®¾è®¡å¸ˆ<br>
                    å¤šå¹´å‰ç«¯å¼€å‘ç»éªŒ
                </p>
                <div style="margin-top: 15px; font-size: 12px; color: #999;">
                    æ“…é•¿ï¼šäº¤äº’è®¾è®¡ã€å¯è§†åŒ–
                </div>
            </div>
            
            <!-- æˆå‘˜5 -->
            <div class="result-item" style="text-align: center; padding: 25px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold;">
                    æ— 
                </div>
                <h4 style="color: #333; margin-bottom: 5px;">æ— </h4>
                <p style="color: #1a6dff; font-size: 14px; margin-bottom: 10px;">äº§å“ç»ç†</p>
                <p style="color: #666; font-size: 13px; line-height: 1.6;">
                    æ— <br>
                    æ— <br>
                    æ‹›ç§Ÿä¸­
                </p>
                <div style="margin-top: 15px; font-size: 12px; color: #999;">
                    æ“…é•¿ï¼šæ— 
                </div>
            </div>
            
            <!-- æˆå‘˜6 -->
            <div class="result-item" style="text-align: center; padding: 25px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%); border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold;">
                    æ— 
                </div>
                <h4 style="color: #333; margin-bottom: 5px;">æ— </h4>
                <p style="color: #1a6dff; font-size: 14px; margin-bottom: 10px;">æ— </p>
                <p style="color: #666; font-size: 13px; line-height: 1.6;">
                    æ— <br>
                    æ— <br>
                    æ‹›ç§Ÿä¸­
                </p>
                <div style="margin-top: 15px; font-size: 12px; color: #999;">
                    æ“…é•¿ï¼šæ— 
                </div>
            </div>
        </div>
        
        <!-- è”ç³»æ–¹å¼ -->
        <div class="result-item" style="margin-top: 30px; text-align: center; background: rgba(26, 109, 255, 0.05);">
            <h4 style="color: #1a6dff; margin-bottom: 15px;">è”ç³»æˆ‘ä»¬</h4>
            <p style="color: #666; line-height: 1.8;">
                ğŸ“§ é‚®ç®±: 3493966891@qq.com<br>
                ğŸŒ å®˜ç½‘: https://wktomo.github.io/finance-calculator/<br>
                ğŸ’¼ å•†åŠ¡åˆä½œè”ç³»: è€è€¿é±¼ï¼ˆè§é‚®ç®±ï¼‰<br>
                æç¤ºï¼šæœ¬è®¡ç®—å™¨åªèƒ½æä¾›å‚è€ƒä½œç”¨ï¼Œå…·ä½“ä»¥å®é™…ä¸ºå‡†
            </p>
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(0,0,0,0.1); color: #999; font-size: 12px;">
                Â© é‡‘èä¸“ç”¨è®¡ç®—å™¨ | é˜¿æ˜Ÿå‡ºå“ï¼Œå¿…å±ç²¾å“
            </div>
        </div>
    </div>
</div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let calculationHistory = JSON.parse(localStorage.getItem('financeCalculatorHistory')) || [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadHistory();
        });

        // ä¾§è¾¹æ åˆ‡æ¢ï¼ˆç§»åŠ¨ç«¯ï¼‰
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('hidden');
        }

        // åˆ‡æ¢æ¨¡å—
        function showModule(moduleId) {
            // éšè—æ‰€æœ‰æ¨¡å—
            document.querySelectorAll('.module-content').forEach(module => {
                module.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­æ¨¡å—
            document.getElementById(moduleId).classList.add('active');
            
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ç§»åŠ¨ç«¯å…³é—­ä¾§è¾¹æ 
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.add('hidden');
            }
        }

        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ•°å­—
        function formatNumber(num, decimals = 2) {
            return parseFloat(num).toFixed(decimals);
        }

        // å·¥å…·å‡½æ•°ï¼šæ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(module, result) {
            const history = {
                module: module,
                result: result,
                date: new Date().toLocaleString('zh-CN')
            };
            
            calculationHistory.unshift(history);
            if (calculationHistory.length > 20) {
                calculationHistory = calculationHistory.slice(0, 20);
            }
            
            localStorage.setItem('financeCalculatorHistory', JSON.stringify(calculationHistory));
            loadHistory();
        }

        // åŠ è½½å†å²è®°å½•
        function loadHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            if (calculationHistory.length === 0) {
                historyList.innerHTML = '<div style="color:#999;font-size:12px;">æš‚æ— è®¡ç®—å†å²</div>';
                return;
            }
            
            calculationHistory.slice(0, 5).forEach((item, index) => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div style="font-weight:500">${item.module}</div>
                    <div style="font-size:12px;color:#666">${item.result}</div>
                    <div class="history-date">${item.date}</div>
                `;
                historyList.appendChild(historyItem);
            });
        }

        // å¤åˆ©è®¡ç®—
        function calculateCompound() {
            const pv = parseFloat(document.getElementById('compoundPV').value);
            const rate = parseFloat(document.getElementById('compoundRate').value) / 100;
            const years = parseFloat(document.getElementById('compoundYears').value);
            const pmt = parseFloat(document.getElementById('compoundPMT').value);
            const freq = parseInt(document.getElementById('compoundFreq').value);
            
            // è®¡ç®—å¤åˆ©ç»ˆå€¼
            const periodicRate = rate / freq;
            const totalPeriods = years * freq;
            
            // FV = PV*(1+r)^n + PMT*[((1+r)^n -1)/r]
            let fv = pv * Math.pow(1 + periodicRate, totalPeriods);
            if (pmt !== 0) {
                fv += pmt * (Math.pow(1 + periodicRate, totalPeriods) - 1) / periodicRate;
            }
            
            const totalPayment = pv + pmt * totalPeriods;
            const totalInterest = fv - totalPayment;
            
            // å±•ç¤ºç»“æœ
            const results = `
                <div class="results-section show" id="compoundResults">
                    <div class="result-item">
                        <div class="result-label">ç»ˆå€¼ (Future Value)</div>
                        <div class="result-value">Â¥${formatNumber(fv)}</div>
                        <div class="result-formula">FV = PVÃ—(1+r)^n + PMTÃ—[((1+r)^n-1)/r]</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æ€»æŠ•å…¥</div>
                        <div class="result-value">Â¥${formatNumber(totalPayment)}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æ€»åˆ©æ¯</div>
                        <div class="result-value">Â¥${formatNumber(totalInterest)}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">å¹´å‡æ”¶ç›Šç‡</div>
                        <div class="result-value">${formatNumber(Math.pow(fv / pv, 1 / years) * 100 - 100, 4)}%</div>
                    </div>
                    
                    <div class="export-buttons">
                        <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                        <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
                    </div>
                </div>
            `;
            
            document.getElementById('compoundResults').outerHTML = results;
            addToHistory('å¤åˆ©è®¡ç®—', `ç»ˆå€¼ Â¥${formatNumber(fv)}`);
        }

        // è´·æ¬¾è®¡ç®—
        function calculateLoan() {
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const annualRate = parseFloat(document.getElementById('loanRate').value) / 100;
            const years = parseInt(document.getElementById('loanYears').value);
            const type = document.getElementById('loanType').value;
            
            const monthlyRate = annualRate / 12;
            const months = years * 12;
            
            let results = '';
            
            if (type === 'equal-payment') {
                // ç­‰é¢æœ¬æ¯ï¼šæ¯æœˆè¿˜æ¬¾é¢ = [æœ¬é‡‘Ã—æœˆåˆ©ç‡Ã—(1+æœˆåˆ©ç‡)^è¿˜æ¬¾æœˆæ•°]Ã·[(1+æœˆåˆ©ç‡)^è¿˜æ¬¾æœˆæ•°-1]
                const monthlyPayment = amount * monthlyRate * Math.pow(1 + monthlyRate, months) / 
                                     (Math.pow(1 + monthlyRate, months) - 1);
                const totalPayment = monthlyPayment * months;
                const totalInterest = totalPayment - amount;
                
                results = `
                    <div class="result-item">
                        <div class="result-label">æœˆä¾›é‡‘é¢</div>
                        <div class="result-value">Â¥${formatNumber(monthlyPayment)}</div>
                        <div class="result-formula">ç­‰é¢æœ¬æ¯ï¼šæ¯æœˆå›ºå®šè¿˜æ¬¾</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">æ€»è¿˜æ¬¾é¢</div>
                        <div class="result-value">Â¥${formatNumber(totalPayment)}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">æ€»åˆ©æ¯</div>
                        <div class="result-value">Â¥${formatNumber(totalInterest)}</div>
                    </div>
                `;
            } else if (type === 'equal-principal') {
                // ç­‰é¢æœ¬é‡‘ï¼šæ¯æœˆè¿˜æ¬¾é¢ = (æœ¬é‡‘/è¿˜æ¬¾æœˆæ•°) + (æœ¬é‡‘-å·²è¿˜æœ¬é‡‘ç´¯è®¡)Ã—æœˆåˆ©ç‡
                const principalPayment = amount / months;
                let totalInterest = 0;
                
                // è®¡ç®—æ€»åˆ©æ¯
                for (let i = 0; i < months; i++) {
                    const interestPayment = (amount - principalPayment * i) * monthlyRate;
                    totalInterest += interestPayment;
                }
                
                const totalPayment = amount + totalInterest;
                const firstPayment = principalPayment + amount * monthlyRate;
                const lastPayment = principalPayment + principalPayment * monthlyRate;
                
                results = `
                    <div class="result-item">
                        <div class="result-label">é¦–æœŸè¿˜æ¬¾</div>
                        <div class="result-value">Â¥${formatNumber(firstPayment)}</div>
                        <div class="result-formula">ç­‰é¢æœ¬é‡‘ï¼šæœˆä¾›é€’å‡</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">æœ«æœŸè¿˜æ¬¾</div>
                        <div class="result-value">Â¥${formatNumber(lastPayment)}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">æ€»åˆ©æ¯</div>
                        <div class="result-value">Â¥${formatNumber(totalInterest)}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">æ€»è¿˜æ¬¾é¢</div>
                        <div class="result-value">Â¥${formatNumber(totalPayment)}</div>
                    </div>
                `;
            }
            
            const resultsHTML = `
                <div class="results-section show" id="loanResults">
                    ${results}
                    <div class="export-buttons">
                        <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                        <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
                    </div>
                </div>
            `;
            
            document.getElementById('loanResults').outerHTML = resultsHTML;
            addToHistory('è´·æ¬¾è®¡ç®—', `${type === 'equal-payment' ? 'ç­‰é¢æœ¬æ¯' : 'ç­‰é¢æœ¬é‡‘'} æœˆä¾› Â¥${formatNumber(monthlyPayment || 0)}`);
        }

        // å€ºåˆ¸å®šä»·è®¡ç®—
        function calculateBond() {
            const faceValue = parseFloat(document.getElementById('bondFaceValue').value);
            const couponRate = parseFloat(document.getElementById('bondCouponRate').value) / 100;
            const years = parseFloat(document.getElementById('bondYears').value);
            const yieldRate = parseFloat(document.getElementById('bondYield').value) / 100;
            
            // æ¯å¹´åˆ©æ¯
            const annualCoupon = faceValue * couponRate;
            
            // å€ºåˆ¸ä»·æ ¼ = âˆ‘(åˆ©æ¯/(1+æ”¶ç›Šç‡)^i) + é¢å€¼/(1+æ”¶ç›Šç‡)^n
            let price = 0;
            for (let i = 1; i <= years; i++) {
                price += annualCoupon / Math.pow(1 + yieldRate, i);
            }
            price += faceValue / Math.pow(1 + yieldRate, years);
            
            const currentYield = annualCoupon / price;
            const duration = calculateDuration(price, annualCoupon, yieldRate, years, faceValue);
            
            const resultsHTML = `
                <div class="results-section show" id="bondResults">
                    <div class="result-item">
                        <div class="result-label">å€ºåˆ¸ä»·æ ¼</div>
                        <div class="result-value">Â¥${formatNumber(price)}</div>
                        <div class="result-formula">ä»·æ ¼ = âˆ‘(C/(1+y)^t) + F/(1+y)^n</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">å½“å‰æ”¶ç›Šç‡</div>
                        <div class="result-value">${formatNumber(currentYield * 100, 4)}%</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">ä¹…æœŸ (Duration)</div>
                        <div class="result-value">${formatNumber(duration, 2)}</div>
                    </div>
                    
                    <div class="export-buttons">
                        <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                        <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
                    </div>
                </div>
            `;
            
            document.getElementById('bondResults').outerHTML = resultsHTML;
            addToHistory('å€ºåˆ¸å®šä»·', `ä»·æ ¼ Â¥${formatNumber(price)}`);
        }

        // è®¡ç®—ä¹…æœŸ
        function calculateDuration(price, coupon, yieldRate, years, faceValue) {
            let duration = 0;
            for (let i = 1; i <= years; i++) {
                const cashFlow = i === years ? coupon + faceValue : coupon;
                duration += i * cashFlow / Math.pow(1 + yieldRate, i);
            }
            return duration / price;
        }

        // æŠ•èµ„ç»„åˆè®¡ç®—
        function calculatePortfolio() {
            const w1 = parseFloat(document.getElementById('weight1').value) / 100;
            const r1 = parseFloat(document.getElementById('return1').value) / 100;
            const w2 = parseFloat(document.getElementById('weight2').value) / 100;
            const r2 = parseFloat(document.getElementById('return2').value) / 100;
            const corr = parseFloat(document.getElementById('correlation').value);
            
            // ç»„åˆæ”¶ç›Š
            const portfolioReturn = w1 * r1 + w2 * r2;
            
            // ç»„åˆé£é™©ï¼ˆç®€åŒ–è®¡ç®—ï¼Œå‡è®¾æ ‡å‡†å·®å‡ä¸º15%ï¼‰
            const sigma1 = 0.15;
            const sigma2 = 0.15;
            const portfolioVariance = w1 * w1 * sigma1 * sigma1 + w2 * w2 * sigma2 * sigma2 + 
                                     2 * w1 * w2 * corr * sigma1 * sigma2;
            const portfolioRisk = Math.sqrt(portfolioVariance);
            
            const resultsHTML = `
                <div class="results-section show" id="portfolioResults">
                    <div class="result-item">
                        <div class="result-label">ç»„åˆé¢„æœŸæ”¶ç›Š</div>
                        <div class="result-value">${formatNumber(portfolioReturn * 100, 4)}%</div>
                        <div class="result-formula">E(Rp) = w1Ã—R1 + w2Ã—R2</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">ç»„åˆé£é™©ï¼ˆæ ‡å‡†å·®ï¼‰</div>
                        <div class="result-value">${formatNumber(portfolioRisk * 100, 4)}%</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">å¤æ™®æ¯”ç‡ï¼ˆå‡è®¾æ— é£é™©åˆ©ç‡3%ï¼‰</div>
                        <div class="result-value">${formatNumber((portfolioReturn - 0.03) / portfolioRisk, 4)}</div>
                    </div>
                    
                    <div class="export-buttons">
                        <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                        <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
                    </div>
                </div>
            `;
            
            document.getElementById('portfolioResults').outerHTML = resultsHTML;
            addToHistory('æŠ•èµ„ç»„åˆ', `æ”¶ç›Š ${formatNumber(portfolioReturn * 100, 2)}%`);
        }

        // CAPMè®¡ç®—
        function calculateCapm() {
            const rf = parseFloat(document.getElementById('riskFreeRate').value) / 100;
            const marketPremium = parseFloat(document.getElementById('marketRiskPremium').value) / 100;
            const beta = parseFloat(document.getElementById('beta').value);
            
            // E(Ri) = Rf + Î²i(E(Rm) - Rf)
            const expectedReturn = rf + beta * marketPremium;
            
            // è®¡ç®—é£é™©è´¡çŒ®
            const systematicRisk = beta * marketPremium;
            
            const resultsHTML = `
                <div class="results-section show" id="capmResults">
                    <div class="result-item">
                        <div class="result-label">é¢„æœŸæ”¶ç›Šç‡</div>
                        <div class="result-value">${formatNumber(expectedReturn * 100, 4)}%</div>
                        <div class="result-formula">E(Ri) = Rf + Î²Ã—(Rm - Rf)</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æ— é£é™©åˆ©ç‡è´¡çŒ®</div>
                        <div class="result-value">${formatNumber(rf * 100, 4)}%</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">é£é™©æº¢ä»·è´¡çŒ®</div>
                        <div class="result-value">${formatNumber(systematicRisk * 100, 4)}%</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">é£é™©è°ƒæ•´åæ”¶ç›Š</div>
                        <div class="result-value">${beta > 1 ? 'é«˜é£é™©' : beta < 1 ? 'ä½é£é™©' : 'ç­‰äºå¸‚åœºé£é™©'}</div>
                    </div>
                    
                    <div class="export-buttons">
                        <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                        <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
                    </div>
                </div>
            `;
            
            document.getElementById('capmResults').outerHTML = resultsHTML;
            addToHistory('CAPMæ¨¡å‹', `é¢„æœŸæ”¶ç›Š ${formatNumber(expectedReturn * 100, 2)}%`);
        }

        // DDMè®¡ç®—
        function calculateDDM() {
            const d0 = parseFloat(document.getElementById('recentDividend').value);
            const g = parseFloat(document.getElementById('growthRate').value) / 100;
            const r = parseFloat(document.getElementById('requiredReturn').value) / 100;
            
            if (g >= r) {
                alert('é”™è¯¯ï¼šå¢é•¿ç‡å¿…é¡»å°äºè¦æ±‚å›æŠ¥ç‡');
                return;
            }
            
            // P0 = D1 / (r - g) = D0(1+g) / (r - g)
            const stockValue = d0 * (1 + g) / (r - g);
            const d1 = d0 * (1 + g);
            
            const resultsHTML = `
                <div class="results-section show" id="ddmResults">
                    <div class="result-item">
                        <div class="result-label">è‚¡ç¥¨å†…åœ¨ä»·å€¼</div>
                        <div class="result-value">Â¥${formatNumber(stockValue)}</div>
                        <div class="result-formula">P0 = D1 / (r - g)</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">é¢„æœŸä¸‹æœŸè‚¡åˆ©</div>
                        <div class="result-value">Â¥${formatNumber(d1)}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">è¦æ±‚å›æŠ¥ç‡æ„æˆ</div>
                        <div class="result-value">è‚¡åˆ©æ”¶ç›Šç‡ ${formatNumber((d1 / stockValue) * 100, 4)}% + å¢é•¿ç‡ ${formatNumber(g * 100, 4)}%</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">åˆç†å¸‚ç›ˆç‡</div>
                        <div class="result-value">${formatNumber(stockValue / d0, 2)} å€</div>
                    </div>
                    
                    <div class="export-buttons">
                        <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                        <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
                    </div>
                </div>
            `;
            
            document.getElementById('ddmResults').outerHTML = resultsHTML;
            addToHistory('DDMä¼°å€¼', `è‚¡ç¥¨ä»·å€¼ Â¥${formatNumber(stockValue)}`);
        }

        // NPV/IRRè®¡ç®—
        function calculateNPV() {
            const initial = parseFloat(document.getElementById('initialInvestment').value);
            const cashFlowsText = document.getElementById('cashFlows').value;
            const discountRate = parseFloat(document.getElementById('discountRate').value) / 100;
            
            // è§£æç°é‡‘æµ
            const cashFlows = cashFlowsText.split(',').map(x => parseFloat(x.trim()));
            const allCashFlows = [initial, ...cashFlows];
            
            // è®¡ç®—NPV
            let npv = initial;
            for (let i = 0; i < cashFlows.length; i++) {
                npv += cashFlows[i] / Math.pow(1 + discountRate, i + 1);
            }
            
            // ä½¿ç”¨ç®€åŒ–æ–¹æ³•ä¼°ç®—IRR
            const irr = calculateIRR(allCashFlows);
            const paybackPeriod = calculatePaybackPeriod(allCashFlows);
            
            // è®¡ç®—ç›ˆåˆ©æŒ‡æ•°
            const pi = (npv - initial) / (-initial) + 1;
            
            const resultsHTML = `
                <div class="results-section show" id="npvResults">
                    <div class="result-item">
                        <div class="result-label">å‡€ç°å€¼ (NPV)</div>
                        <div class="result-value">Â¥${formatNumber(npv)}</div>
                        <div class="result-formula">NPV = âˆ‘CFt/(1+r)^t</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">å†…éƒ¨æ”¶ç›Šç‡ (IRR)</div>
                        <div class="result-value">${formatNumber(irr * 100, 4)}%</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æŠ•èµ„å›æ”¶æœŸ</div>
                        <div class="result-value">${paybackPeriod} å¹´</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">ç›ˆåˆ©æŒ‡æ•° (PI)</div>
                        <div class="result-value">${formatNumber(pi, 4)}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æŠ•èµ„å»ºè®®</div>
                        <div class="result-value" style="color: ${npv > 0 ? '#27ae60' : '#e74c3c'}">${npv > 0 ? 'æ¥å—é¡¹ç›®' : 'æ‹’ç»é¡¹ç›®'}</div>
                    </div>
                    
                    <div class="export-buttons">
                        <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                        <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
                    </div>
                </div>
            `;
            
            document.getElementById('npvResults').outerHTML = resultsHTML;
            addToHistory('NPV/IRR', `NPV Â¥${formatNumber(npv)}`);
        }

        // ç®€åŒ–IRRè®¡ç®—
        function calculateIRR(cashFlows, maxIterations = 100) {
            const guess = 0.1;
            const tolerance = 0.00001;
            
            let rate = guess;
            
            for (let i = 0; i < maxIterations; i++) {
                let npv = 0;
                let npvDerivative = 0;
                
                for (let t = 0; t < cashFlows.length; t++) {
                    const discountFactor = Math.pow(1 + rate, t);
                    npv += cashFlows[t] / discountFactor;
                    npvDerivative -= t * cashFlows[t] / Math.pow(1 + rate, t + 1);
                }
                
                if (Math.abs(npv) < tolerance) {
                    return rate;
                }
                
                rate = rate - npv / npvDerivative;
            }
            
            return rate;
        }

        // è®¡ç®—æŠ•èµ„å›æ”¶æœŸ
        function calculatePaybackPeriod(cashFlows) {
            let cumulative = 0;
            for (let i = 0; i < cashFlows.length; i++) {
                cumulative += cashFlows[i];
                if (cumulative >= 0) {
                    return i + (cumulative - cashFlows[i]) / cashFlows[i];
                }
            }
            return cashFlows.length;
        }

        // å¹´é‡‘è®¡ç®—
        function calculateAnnuity() {
            const pmt = parseFloat(document.getElementById('annuityPayment').value);
            const rate = parseFloat(document.getElementById('annuityRate').value) / 100;
            const periods = parseInt(document.getElementById('annuityPeriods').value);
            const type = document.getElementById('annuityType').value;
            
            let pv, fv, formula;
            
            if (type === 'perpetuity') {
                // æ°¸ç»­å¹´é‡‘ï¼šPV = PMT / r
                pv = pmt / rate;
                fv = Infinity;
                formula = 'æ°¸ç»­å¹´é‡‘ï¼šPV = PMT / r';
            } else if (type === 'due') {
                // é¢„ä»˜å¹´é‡‘
                pv = pmt * (1 - Math.pow(1 + rate, -periods)) / rate * (1 + rate);
                fv = pmt * (Math.pow(1 + rate, periods) - 1) / rate * (1 + rate);
                formula = 'é¢„ä»˜å¹´é‡‘ï¼šæœŸåˆæ”¯ä»˜';
            } else {
                // æ™®é€šå¹´é‡‘
                pv = pmt * (1 - Math.pow(1 + rate, -periods)) / rate;
                fv = pmt * (Math.pow(1 + rate, periods) - 1) / rate;
                formula = 'æ™®é€šå¹´é‡‘ï¼šæœŸæœ«æ”¯ä»˜';
            }
            
            const resultsHTML = `
                <div class="results-section show" id="annuityResults">
                    <div class="result-item">
                        <div class="result-label">ç°å€¼ (PV)</div>
                        <div class="result-value">Â¥${formatNumber(pv)}</div>
                        <div class="result-formula">${formula}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">ç»ˆå€¼ (FV)</div>
                        <div class="result-value">${type === 'perpetuity' ? 'âˆ' : 'Â¥' + formatNumber(fv)}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æ€»æ”¯ä»˜é¢</div>
                        <div class="result-value">Â¥${formatNumber(pmt * periods)}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æ€»åˆ©æ¯</div>
                        <div class="result-value">Â¥${type === 'perpetuity' ? 'âˆ' : formatNumber(fv - pmt * periods)}</div>
                    </div>
                    
                    <div class="export-buttons">
                        <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                        <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
                    </div>
                </div>
            `;
            
            document.getElementById('annuityResults').outerHTML = resultsHTML;
            addToHistory('å¹´é‡‘è®¡ç®—', `ç°å€¼ Â¥${formatNumber(pv)}`);
        }

        // æ³¢åŠ¨ç‡è®¡ç®—
        function calculateVolatility() {
            const returnsText = document.getElementById('returnSeries').value;
            const returns = returnsText.split(',').map(x => parseFloat(x.trim()) / 100);
            
            // è®¡ç®—å¹³å‡æ”¶ç›Š
            const meanReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
            
            // è®¡ç®—æ ‡å‡†å·®ï¼ˆæ³¢åŠ¨ç‡ï¼‰
            const variance = returns.reduce((sum, ret) => sum + Math.pow(ret - meanReturn, 2), 0) / (returns.length - 1);
            const volatility = Math.sqrt(variance);
            
            // è®¡ç®—æœ€å¤§å›æ’¤
            let maxDrawdown = 0;
            let peak = returns[0];
            
            for (let i = 1; i < returns.length; i++) {
                if (returns[i] > peak) {
                    peak = returns[i];
                } else {
                    const drawdown = (peak - returns[i]) / peak;
                    maxDrawdown = Math.max(maxDrawdown, drawdown);
                }
            }
            
            // å¹´åŒ–æŒ‡æ ‡ï¼ˆå‡è®¾æœˆåº¦æ•°æ®ï¼‰
            const annualizedReturn = meanReturn * 12;
            const annualizedVolatility = volatility * Math.sqrt(12);
            
            const resultsHTML = `
                <div class="results-section show" id="volatilityResults">
                    <div class="result-item">
                        <div class="result-label">å¹³å‡æ”¶ç›Šç‡</div>
                        <div class="result-value">${formatNumber(meanReturn * 100, 4)}%</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æ³¢åŠ¨ç‡ï¼ˆæ ‡å‡†å·®ï¼‰</div>
                        <div class="result-value">${formatNumber(volatility * 100, 4)}%</div>
                        <div class="result-formula">Ïƒ = âˆš(âˆ‘(Ri - RÌ„)Â²/(n-1))</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">å¹´åŒ–æ³¢åŠ¨ç‡</div>
                        <div class="result-value">${formatNumber(annualizedVolatility * 100, 4)}%</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æœ€å¤§å›æ’¤</div>
                        <div class="result-value">${formatNumber(maxDrawdown * 100, 4)}%</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æ”¶ç›Šæ³¢åŠ¨æ¯”</div>
                        <div class="result-value">${formatNumber(meanReturn / volatility, 4)}</div>
                    </div>
                    
                    <div class="export-buttons">
                        <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                        <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
                    </div>
                </div>
            `;
            
            document.getElementById('volatilityResults').outerHTML = resultsHTML;
            addToHistory('æ³¢åŠ¨ç‡', `å¹´åŒ–æ³¢åŠ¨ç‡ ${formatNumber(annualizedVolatility * 100, 2)}%`);
        }

        // æœŸæƒå¸Œè…Šå­—æ¯è®¡ç®—
        function calculateOptionGreeks() {
            const S = parseFloat(document.getElementById('underlyingPrice').value);
            const K = parseFloat(document.getElementById('strikePrice').value);
            const T = parseFloat(document.getElementById('timeToExpiry').value);
            const r = parseFloat(document.getElementById('optionRiskFree').value) / 100;
            const sigma = parseFloat(document.getElementById('optionVolatility').value) / 100;
            
            // ç®€åŒ–çš„Black-Scholesè®¡ç®—
            const d1 = (Math.log(S / K) + (r + sigma * sigma / 2) * T) / (sigma * Math.sqrt(T));
            const d2 = d1 - sigma * Math.sqrt(T);
            
            // æ ‡å‡†æ­£æ€åˆ†å¸ƒå‡½æ•°è¿‘ä¼¼
            function N(x) {
                // ä½¿ç”¨è¿‘ä¼¼å…¬å¼
                const a1 = 0.254829592;
                const a2 = -0.284496736;
                const a3 = 1.421413741;
                const a4 = -1.453152027;
                const a5 = 1.061405429;
                const p = 0.3275911;
                
                const sign = x >= 0 ? 1 : -1;
                x = Math.abs(x) / Math.sqrt(2);
                
                const t = 1 / (1 + p * x);
                const y = 1 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
                
                return 0.5 * (1 + sign * y);
            }
            
            // çœ‹æ¶¨æœŸæƒä»·æ ¼å’Œå¸Œè…Šå­—æ¯
            const callPrice = S * N(d1) - K * Math.exp(-r * T) * N(d2);
            const delta = N(d1);
            const gamma = Math.exp(-d1 * d1 / 2) / (S * sigma * Math.sqrt(2 * Math.PI * T));
            
            // çœ‹è·ŒæœŸæƒä»·æ ¼ï¼ˆçœ‹è·Œ-çœ‹æ¶¨å¹³ä»·ï¼‰
            const putPrice = callPrice - S + K * Math.exp(-r * T);
            const putDelta = delta - 1;
            
            const resultsHTML = `
                <div class="results-section show" id="optionResults">
                    <div class="result-item">
                        <div class="result-label">çœ‹æ¶¨æœŸæƒä»·æ ¼</div>
                        <div class="result-value">Â¥${formatNumber(callPrice)}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">çœ‹è·ŒæœŸæƒä»·æ ¼</div>
                        <div class="result-value">Â¥${formatNumber(putPrice)}</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Delta (çœ‹æ¶¨)</div>
                        <div class="result-value">${formatNumber(delta, 4)}</div>
                        <div class="result-formula">Î” = âˆ‚C/âˆ‚S</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">Gamma</div>
                        <div class="result-value">${formatNumber(gamma, 4)}</div>
                        <div class="result-formula">Î“ = âˆ‚Â²C/âˆ‚SÂ²</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">çœ‹è·ŒæœŸæƒDelta</div>
                        <div class="result-value">${formatNumber(putDelta, 4)}</div>
                    </div>
                    
                    <div class="guide">
                        <h4>å¸Œè…Šå­—æ¯è§£è¯»ï¼š</h4>
                        <ul style="color:#666; font-size:14px; margin-top:10px;">
                            <li>Deltaï¼šæ ‡çš„èµ„äº§ä»·æ ¼å˜åŠ¨1å•ä½ï¼ŒæœŸæƒä»·æ ¼å˜åŠ¨Deltaå•ä½</li>
                            <li>Gammaï¼šDeltaå¯¹æ ‡çš„èµ„äº§ä»·æ ¼å˜åŠ¨çš„æ•æ„Ÿåº¦</li>
                        </ul>
                    </div>
                    
                    <div class="export-buttons">
                        <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                        <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
                    </div>
                </div>
            `;
            
            document.getElementById('optionResults').outerHTML = resultsHTML;
            addToHistory('æœŸæƒå¸Œè…Šå­—æ¯', `Delta ${formatNumber(delta, 3)}`);
        }

        // å¯¼å‡ºåŠŸèƒ½
        function exportToPNG() {
            alert('æ­¤åŠŸèƒ½æš‚æ—¶æœªå¼€å‘\næ•¬è¯·å…³æ³¨åç»­æ›´æ–°ä¼˜åŒ–ï¼Œé˜¿æ˜Ÿå‡ºå“ï¼Œå¿…å±ç²¾å“\næœ¬è®¡ç®—ä»…ä¾›å‚è€ƒï¼Œå…·ä½“ä»¥å®é™…ä¸ºä¸»');
        }

        function exportToPDF() {
            alert('æ­¤åŠŸèƒ½æš‚æ—¶æœªå¼€å‘\næ•¬è¯·å…³æ³¨åç»­æ›´æ–°ä¼˜åŒ–ï¼Œé˜¿æ˜Ÿå‡ºå“ï¼Œå¿…å±ç²¾å“\næœ¬è®¡ç®—ä»…ä¾›å‚è€ƒï¼Œå…·ä½“ä»¥å®é™…ä¸ºä¸»');
        }
        // Black-ScholesæœŸæƒå®šä»·
function calculateBlackScholes() {
    const S = parseFloat(document.getElementById('bsStock').value);
    const K = parseFloat(document.getElementById('bsStrike').value);
    const T = parseFloat(document.getElementById('bsTime').value);
    const sigma = parseFloat(document.getElementById('bsVol').value) / 100;
    const r = parseFloat(document.getElementById('bsRate').value) / 100;
    const q = parseFloat(document.getElementById('bsDividend').value) / 100;
    
    // æ ‡å‡†æ­£æ€åˆ†å¸ƒç´¯ç§¯å‡½æ•°
    function normCDF(x) {
        const t = 1 / (1 + 0.2316419 * Math.abs(x));
        const d = 0.3989423 * Math.exp(-x * x / 2);
        const prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
        return x > 0 ? 1 - prob : prob;
    }
    
    // è®¡ç®—d1å’Œd2
    const d1 = (Math.log(S / K) + (r - q + sigma * sigma / 2) * T) / (sigma * Math.sqrt(T));
    const d2 = d1 - sigma * Math.sqrt(T);
    
    // æœŸæƒä»·æ ¼
    const callPrice = S * Math.exp(-q * T) * normCDF(d1) - K * Math.exp(-r * T) * normCDF(d2);
    const putPrice = K * Math.exp(-r * T) * normCDF(-d2) - S * Math.exp(-q * T) * normCDF(-d1);
    
    // å¸Œè…Šå­—æ¯
    const delta_call = Math.exp(-q * T) * normCDF(d1);
    const delta_put = -Math.exp(-q * T) * normCDF(-d1);
    const gamma = Math.exp(-q * T) * Math.exp(-d1 * d1 / 2) / (S * sigma * Math.sqrt(2 * Math.PI * T));
    const vega = S * Math.exp(-q * T) * Math.exp(-d1 * d1 / 2) * Math.sqrt(T) / Math.sqrt(2 * Math.PI);
    const theta_call = -(S * sigma * Math.exp(-q * T) * Math.exp(-d1 * d1 / 2) / (2 * Math.sqrt(2 * Math.PI * T))) - 
                       r * K * Math.exp(-r * T) * normCDF(d2) + q * S * Math.exp(-q * T) * normCDF(d1);
    const rho_call = K * T * Math.exp(-r * T) * normCDF(d2);
    
    const resultsHTML = `
        <div class="results-section show" id="bsResults">
            <div class="result-item">
                <div class="result-label">çœ‹æ¶¨æœŸæƒä»·æ ¼ (Call)</div>
                <div class="result-value">Â¥${formatNumber(callPrice, 4)}</div>
                <div class="result-formula">C = SÃ—e^(-qT)Ã—N(d1) - KÃ—e^(-rT)Ã—N(d2)</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">çœ‹è·ŒæœŸæƒä»·æ ¼ (Put)</div>
                <div class="result-value">Â¥${formatNumber(putPrice, 4)}</div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                <div class="result-item">
                    <div class="result-label">Delta (çœ‹æ¶¨)</div>
                    <div class="result-value" style="font-size: 18px;">${formatNumber(delta_call, 4)}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Delta (çœ‹è·Œ)</div>
                    <div class="result-value" style="font-size: 18px;">${formatNumber(delta_put, 4)}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Gamma</div>
                    <div class="result-value" style="font-size: 18px;">${formatNumber(gamma, 4)}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Vega</div>
                    <div class="result-value" style="font-size: 18px;">${formatNumber(vega / 100, 4)}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Theta (çœ‹æ¶¨/å¹´)</div>
                    <div class="result-value" style="font-size: 18px;">${formatNumber(theta_call, 4)}</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Rho (çœ‹æ¶¨)</div>
                    <div class="result-value" style="font-size: 18px;">${formatNumber(rho_call / 100, 4)}</div>
                </div>
            </div>
            
            <div class="result-item" style="margin-top: 15px;">
                <div class="result-label">å†…åœ¨ä»·å€¼ vs æ—¶é—´ä»·å€¼</div>
                <div style="color: #666; font-size: 14px; margin-top: 10px;">
                    çœ‹æ¶¨å†…åœ¨ä»·å€¼: Â¥${formatNumber(Math.max(0, S - K), 2)}<br>
                    çœ‹æ¶¨æ—¶é—´ä»·å€¼: Â¥${formatNumber(Math.max(0, callPrice - Math.max(0, S - K)), 2)}
                </div>
            </div>
            
            <div class="export-buttons">
                <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
            </div>
        </div>
    `;
    
    document.getElementById('bsResults').outerHTML = resultsHTML;
    addToHistory('Black-Scholes', `çœ‹æ¶¨ Â¥${formatNumber(callPrice, 2)}`);
}

// VaRé£é™©å€¼è®¡ç®—
function calculateVaR() {
    const portfolio = parseFloat(document.getElementById('varPortfolio').value);
    const returnRate = parseFloat(document.getElementById('varReturn').value) / 100;
    const volatility = parseFloat(document.getElementById('varVolatility').value) / 100;
    const confidence = parseFloat(document.getElementById('varConfidence').value);
    const days = parseInt(document.getElementById('varDays').value);
    
    // æ­£æ€åˆ†å¸ƒçš„åˆ†ä½æ•°ï¼ˆZå€¼ï¼‰
    const zScores = {
        0.90: 1.282,
        0.95: 1.645,
        0.99: 2.326
    };
    const zScore = zScores[confidence];
    
    // è°ƒæ•´åˆ°æŒ‡å®šæ—¶é—´èŒƒå›´
    const dailyReturn = returnRate / 252;
    const dailyVol = volatility / Math.sqrt(252);
    const adjustedReturn = dailyReturn * days;
    const adjustedVol = dailyVol * Math.sqrt(days);
    
    // VaRè®¡ç®—ï¼ˆå‚æ•°æ³•ï¼‰
    const var_abs = portfolio * (zScore * adjustedVol - adjustedReturn);
    const var_pct = (zScore * adjustedVol - adjustedReturn) * 100;
    
    // CVaRï¼ˆæ¡ä»¶VaRï¼‰ä¼°ç®—
    const cvar_abs = portfolio * adjustedVol * Math.exp(-zScore * zScore / 2) / 
                     (Math.sqrt(2 * Math.PI) * (1 - confidence));
    
    const resultsHTML = `
        <div class="results-section show" id="varResults">
            <div class="result-item">
                <div class="result-label">VaR (${(confidence * 100)}%ç½®ä¿¡åº¦, ${days}å¤©)</div>
                <div class="result-value">Â¥${formatNumber(var_abs)}</div>
                <div class="result-formula">åœ¨${days}å¤©å†…ï¼Œæœ‰${(confidence * 100)}%çš„æŠŠæ¡æŸå¤±ä¸è¶…è¿‡æ­¤é‡‘é¢</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">VaRç™¾åˆ†æ¯”</div>
                <div class="result-value">${formatNumber(var_pct, 4)}%</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">CVaR (æ¡ä»¶VaR)</div>
                <div class="result-value">Â¥${formatNumber(cvar_abs)}</div>
                <div class="result-formula">å½“æŸå¤±è¶…è¿‡VaRæ—¶çš„å¹³å‡æŸå¤±</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">é£é™©ç­‰çº§è¯„ä¼°</div>
                <div class="result-value" style="color: ${var_pct > 10 ? '#e74c3c' : var_pct > 5 ? '#f39c12' : '#27ae60'}">
                    ${var_pct > 10 ? 'é«˜é£é™©' : var_pct > 5 ? 'ä¸­ç­‰é£é™©' : 'ä½é£é™©'}
                </div>
            </div>
            
            <div class="result-item">
                <div class="result-label">é£é™©æŒ‡æ ‡</div>
                <div style="color: #666; font-size: 14px; margin-top: 10px;">
                    æ—¥å‡æ³¢åŠ¨: ${formatNumber(dailyVol * 100, 4)}%<br>
                    ${days}å¤©æ³¢åŠ¨: ${formatNumber(adjustedVol * 100, 4)}%<br>
                    Zå€¼: ${zScore}
                </div>
            </div>
            
            <div class="export-buttons">
                <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
            </div>
        </div>
    `;
    
    document.getElementById('varResults').outerHTML = resultsHTML;
    addToHistory('VaRè®¡ç®—', `VaR Â¥${formatNumber(var_abs)}`);
}

// å¤æ™®æ¯”ç‡åŠç›¸å…³æŒ‡æ ‡è®¡ç®—
function calculateSharpe() {
    const portfolioReturn = parseFloat(document.getElementById('sharpeReturn').value) / 100;
    const riskFreeRate = parseFloat(document.getElementById('sharpeRiskFree').value) / 100;
    const stdDev = parseFloat(document.getElementById('sharpeStdDev').value) / 100;
    const marketReturn = parseFloat(document.getElementById('sharpeMarketReturn').value) / 100;
    const beta = parseFloat(document.getElementById('sharpeBeta').value);
    
    // å¤æ™®æ¯”ç‡
    const sharpeRatio = (portfolioReturn - riskFreeRate) / stdDev;
    
    // Treynoræ¯”ç‡
    const treynorRatio = (portfolioReturn - riskFreeRate) / beta;
    
    // Jensen's Alpha
    const expectedReturn = riskFreeRate + beta * (marketReturn - riskFreeRate);
    const alpha = portfolioReturn - expectedReturn;
    
    // ä¿¡æ¯æ¯”ç‡ï¼ˆå‡è®¾è·Ÿè¸ªè¯¯å·®ä¸ºæ ‡å‡†å·®çš„80%ï¼‰
    const trackingError = stdDev * 0.8;
    const informationRatio = (portfolioReturn - marketReturn) / trackingError;
    
    // Sortinoæ¯”ç‡ï¼ˆå‡è®¾ä¸‹è¡Œæ ‡å‡†å·®ä¸ºæ€»æ ‡å‡†å·®çš„70%ï¼‰
    const downsideDeviation = stdDev * 0.7;
    const sortinoRatio = (portfolioReturn - riskFreeRate) / downsideDeviation;
    
    const resultsHTML = `
        <div class="results-section show" id="sharpeResults">
            <div class="result-item">
                <div class="result-label">å¤æ™®æ¯”ç‡ (Sharpe Ratio)</div>
                <div class="result-value">${formatNumber(sharpeRatio, 4)}</div>
                <div class="result-formula">Sharpe = (Rp - Rf) / Ïƒp</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">Treynoræ¯”ç‡</div>
                <div class="result-value">${formatNumber(treynorRatio, 4)}</div>
                <div class="result-formula">æ¯å•ä½ç³»ç»Ÿé£é™©çš„è¶…é¢æ”¶ç›Š</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">Jensen's Alpha</div>
                <div class="result-value" style="color: ${alpha > 0 ? '#27ae60' : '#e74c3c'}">${formatNumber(alpha * 100, 4)}%</div>
                <div class="result-formula">${alpha > 0 ? 'æˆ˜èƒœå¸‚åœº' : 'è·‘è¾“å¸‚åœº'}</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">ä¿¡æ¯æ¯”ç‡ (Information Ratio)</div>
                <div class="result-value">${formatNumber(informationRatio, 4)}</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">Sortinoæ¯”ç‡</div>
                <div class="result-value">${formatNumber(sortinoRatio, 4)}</div>
                <div class="result-formula">è€ƒè™‘ä¸‹è¡Œé£é™©çš„è°ƒæ•´æ”¶ç›Š</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">ç»¼åˆè¯„çº§</div>
                <div class="result-value" style="color: ${sharpeRatio > 1.5 ? '#27ae60' : sharpeRatio > 1 ? '#f39c12' : '#e74c3c'}">
                    ${sharpeRatio > 1.5 ? 'ä¼˜ç§€ â­â­â­â­â­' : sharpeRatio > 1 ? 'è‰¯å¥½ â­â­â­â­' : sharpeRatio > 0.5 ? 'ä¸€èˆ¬ â­â­â­' : 'è¾ƒå·® â­â­'}
                </div>
            </div>
            
            <div class="result-item">
                <div class="result-label">æŒ‡æ ‡è§£è¯»</div>
                <div style="color: #666; font-size: 13px; margin-top: 10px; line-height: 1.8;">
                    â€¢ å¤æ™®æ¯”ç‡ > 1 è¡¨ç¤ºé£é™©è°ƒæ•´åæ”¶ç›Šè¾ƒå¥½<br>
                    â€¢ Alpha > 0 è¡¨ç¤ºè¶…è¶Šå¸‚åœºè¡¨ç°<br>
                    â€¢ ä¿¡æ¯æ¯”ç‡è¶Šé«˜ï¼Œä¸»åŠ¨ç®¡ç†èƒ½åŠ›è¶Šå¼º<br>
                    â€¢ Sortinoæ¯”ç‡å…³æ³¨ä¸‹è¡Œé£é™©ï¼Œæ›´é€‚åˆåŒæ¶æŸå¤±çš„æŠ•èµ„è€…
                </div>
            </div>
            
            <div class="export-buttons">
                <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
            </div>
        </div>
    `;
    
    document.getElementById('sharpeResults').outerHTML = resultsHTML;
    addToHistory('å¤æ™®æ¯”ç‡', `Sharpe ${formatNumber(sharpeRatio, 2)}`);
}

// WACCåŠ æƒå¹³å‡èµ„æœ¬æˆæœ¬è®¡ç®—
function calculateWACC() {
    const equity = parseFloat(document.getElementById('waccEquity').value);
    const debt = parseFloat(document.getElementById('waccDebt').value);
    const costEquity = parseFloat(document.getElementById('waccCostEquity').value) / 100;
    const costDebt = parseFloat(document.getElementById('waccCostDebt').value) / 100;
    const taxRate = parseFloat(document.getElementById('waccTaxRate').value) / 100;
    
    // æ€»èµ„æœ¬
    const totalCapital = equity + debt;
    
    // æƒé‡
    const equityWeight = equity / totalCapital;
    const debtWeight = debt / totalCapital;
    
    // WACCè®¡ç®—
    const wacc = equityWeight * costEquity + debtWeight * costDebt * (1 - taxRate);
    
    // ç¨ç›¾ä»·å€¼ï¼ˆå¹´åº¦ï¼‰
    const taxShield = debt * costDebt * taxRate;
    
    // èµ„æœ¬ç»“æ„åˆ†æ
    const debtRatio = debt / totalCapital;
    const equityRatio = equity / totalCapital;
    
    // ç¨åå€ºåŠ¡æˆæœ¬
    const afterTaxDebtCost = costDebt * (1 - taxRate);
    
    const resultsHTML = `
        <div class="results-section show" id="waccResults">
            <div class="result-item">
                <div class="result-label">WACC (åŠ æƒå¹³å‡èµ„æœ¬æˆæœ¬)</div>
                <div class="result-value">${formatNumber(wacc * 100, 4)}%</div>
                <div class="result-formula">WACC = E/VÃ—Re + D/VÃ—RdÃ—(1-Tc)</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">èµ„æœ¬ç»“æ„</div>
                <div style="color: #666; font-size: 14px; margin-top: 10px;">
                    æƒç›Šå æ¯”: ${formatNumber(equityRatio * 100, 2)}%<br>
                    å€ºåŠ¡å æ¯”: ${formatNumber(debtRatio * 100, 2)}%<br>
                    èµ„äº§è´Ÿå€ºç‡: ${formatNumber((debt / (debt + equity)) * 100, 2)}%
                </div>
            </div>
            
            <div class="result-item">
                <div class="result-label">ç¨åå€ºåŠ¡æˆæœ¬</div>
                <div class="result-value">${formatNumber(afterTaxDebtCost * 100, 4)}%</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">å¹´åº¦ç¨ç›¾ä»·å€¼</div>
                <div class="result-value">Â¥${formatNumber(taxShield)}ä¸‡</div>
                <div class="result-formula">ç¨ç›¾ = å€ºåŠ¡ Ã— å€ºåŠ¡æˆæœ¬ Ã— ç¨ç‡</div>
            </div>
            
            <div class="result-item">
                <div class="result-label">èµ„æœ¬æˆæœ¬åˆ†è§£</div>
                <div style="color: #666; font-size: 14px; margin-top: 10px;">
                    æƒç›Šæˆæœ¬è´¡çŒ®: ${formatNumber(equityWeight * costEquity * 100, 4)}%<br>
                    å€ºåŠ¡æˆæœ¬è´¡çŒ®: ${formatNumber(debtWeight * afterTaxDebtCost * 100, 4)}%
                </div>
            </div>
            
            <div class="result-item">
                <div class="result-label">èµ„æœ¬ç»“æ„å»ºè®®</div>
                <div class="result-value" style="color: ${debtRatio > 0.6 ? '#e74c3c' : debtRatio > 0.4 ? '#f39c12' : '#27ae60'}">
                    ${debtRatio > 0.6 ? 'æ æ†åé«˜ï¼Œå…³æ³¨å¿å€ºé£é™©' : debtRatio > 0.4 ? 'èµ„æœ¬ç»“æ„åˆç†' : 'å¯é€‚å½“å¢åŠ å€ºåŠ¡èèµ„'}
                </div>
            </div>
            
            <div class="result-item">
                <div class="result-label">åº”ç”¨åœºæ™¯</div>
                <div style="color: #666; font-size: 13px; margin-top: 10px; line-height: 1.8;">
                    â€¢ é¡¹ç›®æŠ•èµ„å†³ç­–çš„æœ€ä½å›æŠ¥ç‡è¦æ±‚<br>
                    â€¢ ä¼ä¸šä¼°å€¼ä¸­çš„æŠ˜ç°ç‡<br>
                    â€¢ èµ„æœ¬é¢„ç®—å’Œèµ„æœ¬ç»“æ„ä¼˜åŒ–<br>
                    â€¢ EVAç»æµå¢åŠ å€¼è®¡ç®—
                </div>
            </div>
            
            <div class="export-buttons">
                <button class="btn-export" onclick="exportToPNG()">å¯¼å‡ºPNG</button>
                <button class="btn-export" onclick="exportToPDF()">å¯¼å‡ºPDF</button>
            </div>
        </div>
    `;
    
    document.getElementById('waccResults').outerHTML = resultsHTML;
    addToHistory('WACCè®¡ç®—', `WACC ${formatNumber(wacc * 100, 2)}%`);
}

        // Windows Resize äº‹ä»¶å¤„ç†
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('sidebar').classList.remove('hidden');
            }
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            // Ctrl+Enter å¿«é€Ÿè®¡ç®—
            if (e.ctrlKey && e.key === 'Enter') {
                const activeModule = document.querySelector('.module-content.active');
                const calculateBtn = activeModule.querySelector('.btn-calculate');
                if (calculateBtn) {
                    calculateBtn.click();
                }
            }
            
            // ESC å…³é—­ä¾§è¾¹æ 
            if (e.key === 'Escape' && window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.add('hidden');
            }
        });
    </script>
</body>
</html>
